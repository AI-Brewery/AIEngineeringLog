---
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/home/Navigation.tsx';
import { getAllCollectionsWithStatsSafe } from '../../utils/collections.js';

// Get all collections with dynamic post counts from central configuration
// Using safe version to ensure page always loads even if there are errors
let collections: any[] = [];
let errorMessage: string | null = null;

try {
  collections = await getAllCollectionsWithStatsSafe();
} catch (error) {
  console.error('Failed to load collections:', error);
  errorMessage = 'Failed to load collections. Please try again later.';
  collections = [];
}
---

<Layout 
  title="Collections - AIEngineeringLog"
  description="Browse our curated collections of AI engineering tutorials, from RAG systems to production deployment."
>
  <div class="page-container">
    <Navigation client:load currentPath="/collections" />
    
    <main class="main-content">
      <header class="collections-header">
        <h1 class="collections-title">Learning Collections</h1>
        <p class="collections-subtitle">Organized learning paths from students who've actually built this stuff</p>
        
        {errorMessage && (
          <div class="error-message" style="background: #fee; border: 1px solid #fcc; padding: 1rem; border-radius: 4px; margin-top: 1rem;">
            <p style="color: #c33; margin: 0;">⚠️ {errorMessage}</p>
          </div>
        )}
      </header>

      <div class="collections-grid">
        {collections.map(collection => (
          <article class="collection-card">
            <div class="collection-header">
              <div class="collection-icon">
                <!-- Unified icon style (optional placeholder); actual icons can be added via config if needed -->
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="7" height="7"></rect>
                  <rect x="14" y="3" width="7" height="7"></rect>
                  <rect x="14" y="14" width="7" height="7"></rect>
                  <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
              </div>
              <div class="collection-info">
                <h2 class="collection-name">
                  <a href={`/collections/${collection.slug}`}>{collection.title}</a>
                </h2>
                <p class="collection-description">{collection.description}</p>
              </div>
            </div>

            <div class="collection-stats">
              <div class="stat">
                <span class="stat-value">{collection.postCount}</span>
                <span class="stat-label">Posts</span>
              </div>
            </div>
            
            <div class="collection-tags">
              {collection.tags.map((tag: string) => (
                <span class="collection-tag">{tag}</span>
              ))}
            </div>
            
            <div class="collection-footer">
              <a href={`/collections/${collection.slug}`} class="start-learning-btn">
                Start Learning →
              </a>
            </div>
          </article>
        ))}
      </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2025 AIEngineeringLog. Made by students, for students. Still figuring it out together. ✨</p>
      </div>
    </footer>
  </div>
</Layout>

 