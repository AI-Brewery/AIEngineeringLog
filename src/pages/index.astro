---
import Layout from '../layouts/Layout.astro';
import Navigation from '../components/home/Navigation.tsx';
import HeroSection from '../components/home/HeroSection.tsx';
import FeaturedCollections from '../components/home/FeaturedCollections.tsx';
import { getCollection } from 'astro:content';
import { COLLECTIONS_CONFIG } from '../config/collections.js';

// Fetch collections data dynamically
const collectionsWithStats = await Promise.all(
  Object.entries(COLLECTIONS_CONFIG).map(async ([slug, config]) => {
    try {
      const posts = await getCollection(slug as any);
      const postCount = posts.filter((post: any) => post.id !== 'index').length;
      
      return {
        ...config,
        totalPosts: postCount,
        featured: true, // Mark all as featured for now
      };
    } catch (error) {
      // If collection doesn't exist yet, return with 0 posts
      return {
        ...config,
        totalPosts: 0,
        featured: true,
      };
    }
  })
);
---

<Layout 
  title="AIEngineeringLog - AI Brewery Club"
  description="A blog-based course on AI engineering by AI Brewery Club. Learn through practical projects and hands-on tutorials."
>
  <div class="page-container">
    <Navigation client:load currentPath="/" />
    <main class="main-content">
      <HeroSection client:load />
      <FeaturedCollections client:load collectionsData={collectionsWithStats} />
    </main>
    
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2025 AIEngineeringLog. AI Brewery Club. âœ¨</p>
        </div>
      </div>
    </footer>
  </div>
</Layout>
